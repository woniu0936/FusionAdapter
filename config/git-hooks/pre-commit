#!/bin/bash

echo "ğŸ” [FusionAdapter] Checking API binary compatibility..."

# è¿è¡Œ apiCheck
# å¦‚æœæ˜¯ Windows ç¯å¢ƒï¼ŒGit Bash é€šå¸¸ä¹Ÿèƒ½è¯†åˆ« ./gradlew
# å¦‚æœé‡åˆ°æƒé™é—®é¢˜ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨å°è¯•èµ‹äºˆæ‰§è¡Œæƒé™
if [ ! -x "./gradlew" ]; then
    chmod +x ./gradlew
fi

./gradlew apiCheck --daemon

EXIT_CODE=$?

if [ $EXIT_CODE -ne 0 ]; then
    echo " "
    echo "âŒ [Error] API check failed!"
    echo "âš ï¸  It seems you modified the public API but forgot to update the API signature file."
    echo "ğŸ’¡ Please run the following command to update the API dump, then add the changes:"
    echo " "
    echo "    ./gradlew apiDump"
    echo "    git add ."
    echo " "
    exit 1
fi

echo "âœ… [Success] API check passed."
exit 0